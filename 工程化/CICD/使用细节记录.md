### groovy

- printf立即格式化输出
- sprintf格式化但不输出，供后续使用，  通过赋值给定义的对象后，调用execute()执行

### jenkins

- ![](img\微信截图_20210122183518.png)

- scrit代码块中的def表示定义一个局部变量

- 加载外部groovy代码：load(path)， path以当前groovy所在路径为更目录，如果创建了subfolder，则以subfolder为更目录

  ![](img\微信截图_20210122160453.png)

- 很多jenkins相关的参数需要安装 `jenkins`插件才可以获取。比如：`env.BUILD_UESR`只有在安装了`build user vars `插件才可以获取。

- versionnumber插件：用来生成本次Job版本号

- when中对符合指令的判断，同时也可以用来决定是否要执行要给`stage`的功能：allOf, anyOf, not,而不是用groovy的逻辑运算符

  ```
  when {
  allOf {
  branch 'master'
  environment name: 'DEPLOY_TO', value: 'production'
  }
  }
  ```

- Credentials（凭证）的作用：省去了分开设置用户名密码的步骤

- 一个scope中不能出现同名变量，即不可以` txt  = "dd"+txt`的操作

### Unity侧

#### 命令行参数

使用[Unity命令行参数](https://docs.unity3d.com/Manual/CommandLineArguments.html)打开unity会执行一系列指令，让Unity做一些事情。

- -logfile ：指定logFile输出路径。如果使用“- ”，则输出到 jenkins 日志中；

- 通过`GetCMDLineArg`获取自定义参数，然后实现参数功能，即可完成命令的自定义扩展；

代码调用`Unity`执行构建走的是[BuildPipeline API](https://docs.unity3d.com/ScriptReference/BuildPipeline.html), 

#### 用命令行打包AB

调用[BuildAssetBundles](https://docs.unity3d.com/ScriptReference/BuildPipeline.BuildAssetBundle.html)

打包好AB之后怎么办？

- 把AB资源复制到本地热更路径，然后把热更路径更新到SVN（由于版本不同，客户端会自动下载最新的AB）
- 如果是打的小包，就把StreamingAssets目录清空

#### 使用OBB需要考虑什么？

- 怎么校验OBB是否存在？（避免重复下载）
  - 检测Obb文件是否存在
  - 根据Obb文件生成校验码
  - 读取setting.xml文件，并与校验码做对比
- 怎么校验OBB资源正常可用？
  - 根据现有OBB生成校验码，然后和Assets/bin/Data/Setting.xml中的obb校验码进行比较
  - 如果不匹配就重新下载OBB
- OBB包怎么打？
  - PlayerSettings.Android.[useAPKExpansionFiles](https://docs.unity3d.com/ScriptReference/PlayerSettings.Android-useAPKExpansionFiles.html)标记位勾选后，Unity在打包的时候会生成两份文件:   **.**apk + **.**obb
  - OBB有两种命名规则：
    - main文件：main.<expansion-version>.<package-name>.obb
    - patch文件：patch.<expansion-version>.<package-name>.obb
- OBB包和安装包的资源划分是怎样的？
  - APK：可执行文件、插件、脚本以及第一个场景的数据。尽量减小第一个场景的尺寸。
  - OBB：除此之外的所有东西，包括所有其他场景、资源、StreamingAssets
- 如何加载OBB内资源到内存中使用？
  - 首先不要单独使用OBB中的资源，依然将OBB+APK视为一个整体；
- Jenkins怎么打OBB包？
  - 增加任务中的自定义参数；
  - 将参数传递到C#层中的Unity命令参数扩展函数中；
  - 函数中设置Unity打包时的OBB标记；
- OBB包和小包区别？
  - OBB包是和APK包一起构建的，里面存放了APK包分离出来的数据资源。
  - 小包是只包含基础资源的APK，可能只有一个开始页所需的资源。
- 打出来的OBB包需要和APK包一起提交GooglePlay吗？
  - 可以提交给商店，也可以提交到自己的服务器（需要下载到指定目录）。
- 怎么下载OBB包？
  - Unity官方[推荐了一种方式](https://github.com/Over17/UnityOBBDownloader)：这是一个插件，它是通过安卓原生层去远端下载在本机。
- Unity官方关于OBB怎么解释的？
  - [官方文档](https://docs.unity3d.com/Manual/android-OBBsupport.html)
  - [关于如何在Unity中使用安卓插件](https://docs.unity3d.com/Manual/android-OBBsupport.html)
- 扩展阅读：
  - [使用OBB的正确姿势](https://www.jianshu.com/p/af3f8e8f2a96)